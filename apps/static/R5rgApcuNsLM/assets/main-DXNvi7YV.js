(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();let s;document.addEventListener("DOMContentLoaded",function(){s=new T,O(),typeof PluginMessageHandler<"u"?(console.log("Running as R1 Creation"),P()):console.log("Running in browser mode")});function O(){window.addEventListener("scrollUp",()=>{s.handleScroll()}),window.addEventListener("scrollDown",()=>{s.handleScroll()}),window.addEventListener("sideClick",()=>{s.handleScroll()})}window.onPluginMessage=function(o){if(console.log("Received plugin message:",o),o.data)try{const e=JSON.parse(o.data);e.x!==void 0&&e.y!==void 0&&e.z!==void 0&&s.handleShake(e)}catch{if(o.data&&typeof o.data=="string"){const t=o.data.trim().toUpperCase();s.saveFortune(t),s.setFortune(t)}}else if(o.message){const e=o.message.trim().toUpperCase();s.saveFortune(e),s.setFortune(e)}};function P(){window.creationSensors&&window.creationSensors.accelerometer&&window.creationSensors.accelerometer.start(o=>{s.handleShake(o)},{frequency:60})}class T{constructor(){this.canvas=document.getElementById("dither-canvas"),this.ctx=this.canvas.getContext("2d",{alpha:!0}),this.canvas.width=240,this.canvas.height=282,this.container=document.getElementById("fortune-container"),this.typingSound=document.getElementById("typingSound"),this.time=0,this.bgTime=0,this.currentFortune="CALCULATING YOUR DESTINY...",this.isRendering=!1,this.lastShake=0,this.lastFortuneDate=null,this.checkDailyFortune(),this.initializeDithering(),setTimeout(()=>this.startTextRendering(),1e3)}initializeDithering(){this.bayerMatrix=[[0,32,8,40,2,34,10,42],[48,16,56,24,50,18,58,26],[12,44,4,36,14,46,6,38],[60,28,52,20,62,30,54,22],[3,35,11,43,1,33,9,41],[51,19,59,27,49,17,57,25],[15,47,7,39,13,45,5,37],[63,31,55,23,61,29,53,21]],this.animate()}seededRandom(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}noise(e,t){const r=e*12.9898+t*78.233;return this.seededRandom(r)}handleScroll(){this.startTextRendering()}handleShake(e){const t=Date.now();Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)>15&&t-this.lastShake>1e3&&(this.lastShake=t,this.startTextRendering())}setFortune(e){this.currentFortune=e,this.startTextRendering()}async startTextRendering(){if(this.isRendering)return;this.isRendering=!0,this.container.textContent="";let e=0;for(;e<this.currentFortune.length;){const t=this.currentFortune[e];await this.renderNextChar(t),e++}this.isRendering=!1}async renderNextChar(e){return new Promise(t=>{setTimeout(()=>{if(this.container.textContent+=e,e!==" ")try{const r=this.typingSound.cloneNode();r.volume=.3,r.play().catch(()=>{})}catch{}t()},e===" "?500:100)})}animate(){this.time+=this.isRendering?4:.5,this.createDitheredPattern(),requestAnimationFrame(()=>this.animate())}createDitheredPattern(){const e=this.canvas.width,t=this.canvas.height;this.ctx.clearRect(0,0,e,t);const r=this.ctx.createImageData(e,t),n=r.data,i=3,d=.8,R=e/2,F=t/2,M=[0,0,0,0],D=[255,1,1,255];for(let a=0;a<t;a+=i)for(let c=0;c<e;c+=i){const m=(c-R)*d,w=(a-F)*d,y=Math.sqrt(m*m+w*w),p=.01,S=this.noise(c*p,a*p),v=Math.sin(this.time*.1+S*Math.PI*2)*30,N=Math.atan2(w,m),b=Math.sin(N*3+this.time*.05)*40,x=(this.isRendering?100:80)+b+v;let l=0;y<x&&(l=1-y/x,l+=(S-.5)*.3,l=Math.max(0,Math.min(1,l)));const L=Math.floor(c/i)%8,C=Math.floor(a/i)%8,I=this.bayerMatrix[C][L]/64,h=l>I?D:M;for(let u=0;u<i&&a+u<t;u++)for(let g=0;g<i&&c+g<e;g++){const f=((a+u)*e+(c+g))*4;n[f]=h[0],n[f+1]=h[1],n[f+2]=h[2],n[f+3]=h[3]}}this.ctx.putImageData(r,0,0)}async checkDailyFortune(){const e=new Date().toDateString();try{if(window.creationStorage&&window.creationStorage.plain){const t=await window.creationStorage.plain.getItem("fortune_data");if(t){const r=JSON.parse(atob(t));r.date!==e?this.generateNewFortune():(this.currentFortune=r.fortune,this.startTextRendering())}else this.generateNewFortune()}else this.generateNewFortune()}catch(t){console.error("Storage error:",t),this.generateNewFortune()}}generateNewFortune(){typeof PluginMessageHandler<"u"&&PluginMessageHandler.postMessage(JSON.stringify({message:"Generate a dystopian fortune cookie message. 3 to 5 words only. Make it weird and eerily applicable to today's AI-overrun world. Just respond with the fortune text, nothing else.",useLLM:!0,wantsR1Response:!1}))}async saveFortune(e){const t=new Date().toDateString();try{if(window.creationStorage&&window.creationStorage.plain){const r=JSON.stringify({date:t,fortune:e});await window.creationStorage.plain.setItem("fortune_data",btoa(r))}}catch(r){console.error("Storage error:",r)}}}
